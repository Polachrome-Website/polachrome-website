<?php

if (isset($_POST["address-edit"])){
	$addressid = $_POST['address'];
	require_once 'db.php';
	header("LOCATION: ../address.php?addressid=" . $addressid);
}

if (isset($_POST["address-save"])){
	$addressid = $_POST["addressid"];
	$contactNum = $_POST["contactNum"];
    $bldg = $_POST["bldg"];
    $strt = $_POST["strt"];
    $brgy = $_POST["brgy"];
    $city = $_POST["city"];
    $region = $_POST["region"];
    $zip = $_POST["zip"];
	
	require_once 'db.php';

	// $sql = "UPDATE user_account_address SET city='" . $city . "' WHERE addressID= '" . $addressid . "';";
	$sql = "UPDATE user_account_address SET contactNum='".$contactNum."', bldg='".$bldg."', strt='".$strt."', brgy='".$brgy."', city='".$city."', region='".$region."', zip='".$zip."'  WHERE addressID='".$addressid."'";
	if (mysqli_query($conn, $sql)) {
		echo "Record updated successfully";
	} else {
		echo "Error updating record: " . mysqli_error($conn);
	}
	header("LOCATION: ../address.php?addressupdate=success");
	exit();
}

if (isset($_POST["address-delete"])){
	$address = $_POST["address"];
	require_once 'db.php';
	$sql = "DELETE FROM user_account_address WHERE addressID='".$address."'";

	if ($conn->query($sql) === TRUE) {
		echo "Record deleted successfully";
	} else {
		echo "Error deleting record: " . $conn->error;
	}
}

if (isset($_POST["address-submit"])) {
    
	$userID = $_POST["userID"];
	$contactNum = $_POST["contactNum"];
    $bldg = $_POST["bldg"];
    $strt = $_POST["strt"];
    $brgy = $_POST["brgy"];
    $city = $_POST["city"];
    $region = $_POST["region"];
    $zip = $_POST["zip"];

    require_once 'db.php';
	
	$sql = "INSERT INTO user_account_address (userID, bldg, strt, brgy, city, region, zip, contactNum) VALUES (?, ?, ?, ?, ?, ?, ?, ?);";   //first colon to close SQL, second to close PHP 
    $stmt = mysqli_stmt_init($conn);
 
    if (!mysqli_stmt_prepare($stmt, $sql)) {
     header("location: ../user-profile.php?erroraddress=stmtfailed");
     exit();
    }else{
		mysqli_stmt_bind_param($stmt, "ssssssss", $userID, $bldg, $strt, $brgy, $city, $region, $zip, $contactNum);
		mysqli_stmt_execute($stmt);
		mysqli_stmt_close($stmt);

		header("location: ../user-profile.php?erroraddress=none");
		exit();
	}

}